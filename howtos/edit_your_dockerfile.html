<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Editing your app’s Dockerfile &mdash; KBase SDK 1.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=28f99aa0" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=6efca38a"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Fully documenting your app" href="fill_out_app_information.html" />
    <link rel="prev" title="Adding UI Elements" href="add_ui_elements.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            KBase SDK
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Intro</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Concepts and Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../video_tutorial.html">Video Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/1_dependencies.html">1. Dependencies &amp; Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/2_install.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/3_initialize.html">3. Initialize the Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/4_helloworld.html">4. Hello World Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/5_setup.html">5. ContigFilter Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/6_inputsoutputs.html">6. Narrative User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/7_implement.html">7. Implement Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/8_publish.html">8. Publish and Update</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../references/questions_and_answers.html">Common Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_a_report.html">Creating reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="add_ui_elements.html">Adding UI Elements</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Editing your app’s Dockerfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="fill_out_app_information.html">Fully documenting your app</a></li>
<li class="toctree-l1"><a class="reference internal" href="run_a_shell_command.html">Running shell commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_utils.html">Working with the file utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="workspace.html">Using Workspace Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual_build.html">Manually building the SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="work_with_reference_data.html">Working with reference data</a></li>
<li class="toctree-l1"><a class="reference internal" href="job_manager.html">Listing and viewing jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamic_services.html">Dynamic Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="update_to_py3.html">Updating a module to Python3</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References &amp; Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../references/design_checklist.html">Design Checklist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/troubleshooting.html">Troubleshooting Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/dev_guidelines.html">Developer Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/execution_engine.html">Job Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/module_anatomy.html">Anatomy of a Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/KIDL_spec.html">KIDL Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/UI_spec.html">Narrative App UI Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/terminology.html">Terminology</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">KBase SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Editing your app’s Dockerfile</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/kbase/kb_sdk_docs/blob/blob/master/source/howtos/edit_your_dockerfile.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="editing-your-app-s-dockerfile">
<h1>Editing your app’s Dockerfile<a class="headerlink" href="#editing-your-app-s-dockerfile" title="Link to this heading"></a></h1>
<p>To set up custom programs for your app, such as third-party tools, you
can edit your Dockerfile, which contains the setup code needed to build
up your container.</p>
<p>A helpful resource is the <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices" target="_blank">Dockerfile Best Practices </a> guide.</p>
<p>The first two lines of the Dockerfile look something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FROM</span> <span class="n">kbase</span><span class="o">/</span><span class="n">sdkbase2</span><span class="p">:</span><span class="n">latest</span>
<span class="n">MAINTAINER</span> <span class="n">KBase</span> <span class="n">Developer</span>
</pre></div>
</div>
<p>Change  <code class="docutils literal notranslate"><span class="pre">KBase</span> <span class="pre">Developer</span></code> to be the email address of the person
who will be responsible for the upkeep of the module.</p>
<p>The base KBase Docker image contains a KBase Ubuntu image with the
dependencies necessary JSON-RPC server in the supported language, as
well as a core set of KBase API Clients. You will need to include any
dependencies, including the installation of whatever tool you are
wrapping, to build a custom Docker image that can run your Module.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RUN</span> \
  <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">voutcn</span><span class="o">/</span><span class="n">megahit</span><span class="o">.</span><span class="n">git</span> <span class="o">&amp;&amp;</span> \
  <span class="n">cd</span> <span class="n">megahit</span> <span class="o">&amp;&amp;</span> \
  <span class="n">git</span> <span class="n">checkout</span> <span class="n">tags</span><span class="o">/</span><span class="n">v1</span><span class="mf">.0.3</span> <span class="o">&amp;&amp;</span> \
  <span class="n">make</span>
</pre></div>
</div>
<p>Note: you do not have to add any lines to the Dockerfile for installing
your SDK Module code, as this will happen automatically. The contents of
your SDK Module git repo will be added at /kb/module.</p>
<p>It is also important to note that layers in the Docker image are
generated by each command in the Dockerfile. To make a streamlined
Docker image which will deploy on a worker node more quickly and make
cycles of a Docker image build faster, it is best to remove any large,
extraneous files, such as a tarball from which you installed a tool.</p>
<p>To accomplish this, commands to your Dockerfile should look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RUN</span> \
  <span class="n">wget</span> <span class="n">blah</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tarball</span><span class="o">.</span><span class="n">tgz</span> <span class="o">&amp;&amp;</span> \
  <span class="n">tar</span> <span class="n">xzf</span> <span class="n">tarball</span><span class="o">.</span><span class="n">tgz</span> <span class="o">&amp;&amp;</span> \
  <span class="n">cd</span> <span class="n">tarball</span> <span class="o">&amp;&amp;</span> \
  <span class="n">make</span> <span class="o">&amp;&amp;</span> \
  <span class="n">cd</span> <span class="o">..</span> <span class="o">&amp;&amp;</span> \
  <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">tarball</span><span class="o">.</span><span class="n">tgz</span>
</pre></div>
</div>
<p>Where each <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> lets you chain together multiple bash commands, and
the backslash continues the same, single-line command over multiple
lines.</p>
<p>Avoid this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RUN</span> <span class="n">wget</span> <span class="n">blah</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tarball</span><span class="o">.</span><span class="n">tgz</span>
<span class="n">RUN</span> <span class="n">tar</span> <span class="n">xzf</span> <span class="n">tarball</span><span class="o">.</span><span class="n">tgz</span>
<span class="n">RUN</span> <span class="n">cd</span> <span class="n">tarball</span>
<span class="n">RUN</span> <span class="n">make</span>
<span class="n">RUN</span> <span class="n">cd</span> <span class="o">..</span>
<span class="n">RUN</span> <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">tarball</span><span class="o">.</span><span class="n">tgz</span>
</pre></div>
</div>
<p>Each call to <code class="docutils literal notranslate"><span class="pre">RUN</span></code> creates a separate Docker image layer that sits on
top of the previous one. Previous layers are read-only, so you can’t
modify their content if you wanted to clean up files. In general, you
will want one <code class="docutils literal notranslate"><span class="pre">RUN</span></code> command for each discrete service that you set up
in your container.</p>
<p>Final note: Docker will rebuild everything from the first detected
change in a dockerfile but pull everything upstream of that from its
cache. If you are pulling in external data using <code class="docutils literal notranslate"><span class="pre">RUN</span></code> and a command
like <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span></code> or <code class="docutils literal notranslate"><span class="pre">wget</span></code>, then changes in those sources will not
automatically be reflected in a rebuilt Docker image unless the Docker
file changes at or before that import.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="add_ui_elements.html" class="btn btn-neutral float-left" title="Adding UI Elements" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="fill_out_app_information.html" class="btn btn-neutral float-right" title="Fully documenting your app" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, KBase.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>